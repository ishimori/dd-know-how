# テンプレートのセクション追加例

DDテンプレートにプロジェクト固有のセクションを追加する例です。

## 基本テンプレート

```markdown
# DD-{番号}: {タイトル}

**ステータス**: 進行中

## 目的
## 背景・課題
## 検討内容
## 決定事項
## タスク一覧
## ログ
```

## 追加可能なセクション

### 1. スコープ（対象範囲）

大きな機能開発で、対象範囲を明確にしたい場合：

```markdown
## スコープ

### 本DDの対象範囲

| 機能 | 内容 |
|------|------|
| ログイン画面 | ID/パスワード認証 |
| セッション管理 | 30分でタイムアウト |

### 対象外（後続DDで実施）

| 機能 | 理由 |
|------|------|
| パスワードリセット | 別DDで対応 |
| 2要素認証 | フェーズ2で検討 |
```

### 2. 実装前チェック

実装前に仕様書・既存コードを確認する場合：

```markdown
## 実装前チェック

### チェック実施日: YYYY-MM-DD

#### 1. 仕様書確認
- 参照ファイル: `doc/spec/03_画面仕様/login.md`
- 確認結果: ID/パスワード認証、セッション管理の仕様あり

#### 2. 既存コード確認
- 参照ファイル: `src/auth/`
- 確認結果: 認証基盤は未実装

#### 3. 設計書との差分
- 漏れている仕様: なし
- 追加で必要な対応: セッションストアの選定
```

### 3. テストシナリオ

テストが重要な機能の場合：

```markdown
## テストシナリオ

### 正常系
- [ ] 正しいID/パスワードでログインできる
- [ ] ログイン後、ホーム画面に遷移する
- [ ] セッションが30分維持される

### 異常系
- [ ] 誤ったパスワードでエラーメッセージが表示される
- [ ] 空入力でバリデーションエラーが表示される
- [ ] 5回失敗でアカウントがロックされる

### 権限
- [ ] 未ログイン状態で保護ページにアクセスするとリダイレクト
```

### 4. 詳細設計

画面設計やデータフローを記載する場合：

```markdown
## 詳細設計

### 画面設計

```
┌─────────────────────────────────────┐
│ ログイン                             │
├─────────────────────────────────────┤
│ ユーザーID  [________________]       │
│ パスワード  [________________]       │
│                                      │
│           [ログイン]                 │
│                                      │
│ パスワードを忘れた方はこちら          │
└─────────────────────────────────────┘
```

### データフロー

```
ユーザー → ログイン画面 → 認証サービス → DB
                ↓
         セッション作成 → ホーム画面へリダイレクト
```
```

### 5. 工数見積もり

見積もりが必要な場合：

```markdown
## 工数見積もり

| タスク | 見積もり | 実績 | 備考 |
|--------|----------|------|------|
| 設計 | 0.5日 | 0.5日 | |
| 実装 | 2日 | 1.5日 | 想定より単純だった |
| テスト | 1日 | 1日 | |
| **合計** | **3.5日** | **3日** | |
```

### 6. リスク

リスク管理が必要な場合：

```markdown
## リスク

| リスク | 影響度 | 発生確率 | 対策 |
|--------|--------|----------|------|
| 既存機能への影響 | 高 | 低 | 既存テストで確認 |
| パフォーマンス劣化 | 中 | 中 | ベンチマーク実施 |
| セキュリティ脆弱性 | 高 | 低 | セキュリティレビュー |
```

### 7. 振り返り

DD完了時に学びを記録する場合：

```markdown
## 振り返り

### うまくいったこと
- 事前に仕様書を確認したことで手戻りなし
- テストシナリオを先に書いたことで実装がスムーズ

### 改善点
- 既存コードの調査に時間がかかった
- セッションストアの選定で迷った

### 後続DDへの申し送り
- セッション管理は `src/session/` に実装済み
- パスワードリセット機能は DD-015 で対応予定
```

### 8. 参考資料

外部リンクや参照資料がある場合：

```markdown
## 参考資料

- [セッション管理のベストプラクティス](https://example.com/session)
- [OWASP認証チートシート](https://cheatsheetseries.owasp.org/cheatsheets/Authentication_Cheat_Sheet.html)
- 社内ドキュメント: `doc/security-guidelines.md`
```

### 9. レビュー

レビュープロセスがある場合：

```markdown
## レビュー

| レビュアー | 承認日 | コメント |
|------------|--------|----------|
| @yamada | 2024-01-15 | LGTM |
| @tanaka | 2024-01-16 | セキュリティ面で1点修正依頼 → 対応済み |
```

### 10. 成果物

DDの成果物を明示する場合：

```markdown
## 成果物

| ファイル | 状態 | 説明 |
|----------|------|------|
| `src/auth/service.py` | 完了 | 認証サービス |
| `src/views/login.py` | 完了 | ログイン画面 |
| `tests/test_auth.py` | 完了 | 認証テスト |
| `doc/spec/03_画面仕様/login.md` | 完了 | 画面仕様書 |
```

## DA批判レビュー記録のカスタマイズ

デフォルトのテンプレートでは、DA批判レビューの手順は `workflow/SKILL.md` に集約し、テンプレートには記録欄のみを配置しています（DRY原則）。

**CLAUDE.md にプロジェクト固有の品質ルールが充実しているプロジェクトでは**、テンプレートのDA記録セクションをさらに簡素化できます：

```markdown
## DA批判レビュー記録

<!-- DA品質フィルター: CLAUDE.md参照 -->

### Phase {N}

| # | 指摘 | 深刻度 | 根拠 | 対応 |
|---|------|--------|------|------|
| 1 | ... | 高/中/低 | ... | ... |
```

これは、CLAUDE.md にテスト対応表・デッドコード検出・仕様書連動ルールなどが常時ルールとして定義されている場合、DA手順のチェックリストと重複するためです。CLAUDE.md の常時ルールがDA観点の品質を既に担保しているので、テンプレート側は記録欄だけで十分です。

## 推奨セクション構成

### 小規模な機能追加

```
目的 → 背景・課題 → 決定事項 → タスク一覧 → ログ
```

### 中規模な機能開発

```
目的 → 背景・課題 → スコープ → 検討内容 → 決定事項
→ タスク一覧 → テストシナリオ → ログ
```

### 大規模な機能開発

```
目的 → 背景・課題 → スコープ → 検討内容 → 決定事項
→ 詳細設計 → 実装前チェック → タスク一覧 → テストシナリオ
→ 工数見積もり → リスク → 成果物 → ログ → 振り返り
```

## テンプレートファイルの更新

プロジェクトで標準的に使うセクションが決まったら、
`doc/templates/dd_template.md` を更新して、
新規DD作成時に自動的に含まれるようにします。

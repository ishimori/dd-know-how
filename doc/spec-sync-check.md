# 仕様書同期チェック

`/dd archive` 実行時に自動で実行される仕様書同期チェックの詳細です。

## 目的

DDで決定・実装した内容が `doc/spec/` の仕様書に反映されているかを確認する。

**なぜ必要か:**
- 実装は進んだが仕様書が更新されていない、という状況を防ぐ
- 仕様書と実装のズレを早期に発見
- プロジェクトのドキュメント品質を維持

## チェックの仕組み

### 1. 変更種別の検出

DDの内容から以下の変更を検出します：

| 変更種別 | 検出キーワード | 関連仕様書 |
|----------|---------------|-----------|
| 画面の追加・変更 | 「画面」「UI」「表示」「ページ」 | `doc/spec/03_画面仕様/` |
| テーブル・カラムの追加・変更 | 「テーブル」「カラム」「DB」「データベース」 | `doc/spec/04_テーブル定義.md` |
| 機能の追加・変更 | 「機能」「追加」「実装」「新規」 | `doc/spec/02_機能一覧.md` |
| 業務フローの変更 | 「フロー」「処理」「手順」 | `doc/spec/03_業務フロー.md` |

### 2. チェック対象セクション

DDの以下のセクションを分析します：
- **決定事項** - 最終的に何を決めたか
- **タスク一覧** - 実行したタスク
- **ログ** - 実施内容の記録

### 3. 仕様書との照合

関連する仕様書を読み込み、DDの変更内容が記載されているか確認します。

## 出力フォーマット

```markdown
## 仕様書同期チェック結果

### 検出された変更

| 変更内容 | 関連仕様書 | 反映状況 |
|----------|-----------|----------|
| ログイン画面を追加 | 03_画面仕様/login.md | ✅ 反映済 |
| usersテーブルにカラム追加 | 04_テーブル定義.md | ⚠️ 要確認 |
| 認証機能を実装 | 02_機能一覧.md | ✅ 反映済 |

### 判定基準
- ✅ 反映済: 仕様書に該当内容が記載されている
- ⚠️ 要確認: 仕様書に該当内容が見つからない、または古い可能性

### 対応が必要な場合
⚠️ の項目がある場合は、仕様書を更新してから再度アーカイブを実行してください。
```

## アーカイブ可否の判定

### 全項目が ✅ の場合
→ そのままアーカイブ実行

### ⚠️ が1つ以上ある場合
→ ユーザーに確認

選択肢：
1. **仕様書を更新する** - 該当する仕様書を更新してから再度アーカイブ
2. **このままアーカイブ** - 意図的にスキップ（内部ドキュメントなど、仕様書更新不要の場合）

## カスタマイズ

### 仕様書フォルダ構成の変更

プロジェクトの仕様書構成に合わせて、関連仕様書のパスを調整してください。

**デフォルト構成:**
```
doc/spec/
├── 01_システム概要.md
├── 02_機能一覧.md
├── 03_画面仕様/
│   └── ...
└── 04_テーブル定義.md
```

**カスタム例:**
```
doc/
├── overview.md
├── features.md
├── screens/
│   └── ...
└── database.md
```

### 検出キーワードの追加

プロジェクト固有の用語を検出キーワードに追加できます。

例：
- 「API」→ `doc/spec/05_API仕様.md`
- 「バッチ」→ `doc/spec/06_バッチ処理.md`

## 実践例

### DD-010: ログイン機能の実装

**DDの決定事項:**
```markdown
## 決定事項
- ログイン画面を新規作成
- usersテーブルにlast_login_atカラムを追加
- セッションベース認証を採用
```

**仕様書同期チェック結果:**
```
| 変更内容 | 関連仕様書 | 反映状況 |
|----------|-----------|----------|
| ログイン画面を新規作成 | 03_画面仕様/login.md | ✅ 反映済 |
| usersテーブルにlast_login_atカラム追加 | 04_テーブル定義.md | ⚠️ 要確認 |
| セッションベース認証を採用 | 02_機能一覧.md | ✅ 反映済 |
```

**対応:**
1. `04_テーブル定義.md` に `last_login_at` カラムを追記
2. 再度 `/dd archive DD-010` を実行

## よくある質問

### Q: 全ての変更をチェックしなければいけない？

A: 仕様書に反映すべき変更のみチェックします。内部的なリファクタリングや実装詳細は対象外です。

### Q: 仕様書がないプロジェクトでも使える？

A: はい。仕様書同期チェックはオプション機能です。Level 2では仕様書連携なしでDDを運用できます。

### Q: チェックを無効化できる？

A: `/dd archive --skip-sync-check DD-XXX` のようなオプションを追加することで無効化できます（カスタマイズが必要）。

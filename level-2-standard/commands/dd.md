# DD設計書操作コマンド

DD（Design Document）設計書を操作するコマンドです。

## 引数の解釈

### DD番号の指定（柔軟に解釈する）
以下はすべて同じDD-001を指す：
- `DD-001` / `DD 001` / `DD001` / `001` / `1`

→ 番号部分（数字）を抽出して3桁にゼロパディング（1 → 001）

### 識別子付きDD（チーム開発時）
識別子付きの場合も同様に柔軟に解釈：
- `DDI-001` / `DDI 001` / `DDI001`（石森のDD）
- `DDSA-001` / `DDSA001`（斉藤のDD）

→ 識別子部分（DD直後のアルファベット）と番号部分を抽出

### コマンド
- `{番号}` → 該当DDを参照
- `new タイトル` → 新規DD作成
- `list` → 進行中DD一覧
- `archive {番号}` → DDをアーカイブ
- `update {番号}` → DDを更新（ログ追記含む）

## 操作手順

### 参照（DD-001, 001 など）
1. `doc/DD/DD-{番号}_*.md` を検索（メインファイルは常に直下）
2. なければ `doc/archived/DD/DD-{番号}_*.md` を検索
3. **DD本体のみ読み込む**（リンク先は自動で読み込まない）
4. 内容を要約して表示
5. 添付フォルダ `doc/DD/DD-{番号}/` があれば、その存在とファイル一覧を通知
6. 「何をしますか？」と確認

#### リンク先の自動読み込み防止（重要）

**デフォルト動作**: DD参照時はDD本体（.mdファイル）のみ読み込む。

以下は**自動で読み込まない**：
- 添付フォルダ内のファイル（HTML、画像等）
- 参照ドキュメントへのリンク先
- 流用元・関連DDへのリンク先

**理由**: リンク先を自動で読み込むと、芋づる式にコンテキストを消費する。

**明示的な作業指示があった場合**:
ユーザーが具体的な作業を指示した場合は、必要なファイルを読み込んでよい：
- 「landing.htmlを修正して」→ landing.html を読み込む
- 「HTMLモックを全部確認して」→ 添付フォルダ内を読み込む
- 「関連DDも確認して」→ 関連DDを読み込む

これらは意図的な読み込みなので、コンテキスト消費は許容する。

### 新規作成（new タイトル）
1. **識別子の確認**
   - CLAUDE.mdに作業者識別子が設定されていれば使用（例: `作業者識別子: I`）
   - 未設定の場合は従来の `DD-{番号}` 形式
2. **既存DD番号の確認（重要）**
   - 識別子付き: `doc/DD/DD{識別子}-*.md` と `doc/archived/DD/DD{識別子}-*.md` を検索
   - 識別子なし: `doc/DD/DD-*.md` と `doc/archived/DD/DD-*.md` を検索
   - 該当する系列から最大番号を取得
3. 次の連番でファイルを作成
   - 識別子付き: `DD{識別子}-{連番}_{タイトル}.md`
   - 識別子なし: `DD-{連番}_{タイトル}.md`
4. テンプレートファイルをコピー: `doc/templates/dd_template.md` を読み込み、`{番号}` `{タイトル}` `{日付}` を置換

**注意**: 番号重複を防ぐため、必ずアーカイブ済みDDも含めて最大番号を確認すること

### 一覧（list）
1. `doc/DD/` 内のDD一覧を表示
2. 各DDのタイトルとステータスを表示

### アーカイブ（archive DD-001）
1. 該当DDの全タスクが完了しているか確認
2. `doc/DD/` から `doc/archived/DD/` に移動
   - メインファイル `DD-{番号}_*.md` を移動
   - 添付フォルダ `DD-{番号}/` がある場合は**フォルダごと移動**

## DDテンプレート

テンプレートファイル: `doc/templates/dd_template.md`

新規DD作成時は、このファイルを読み込んで以下を置換する：
- `{番号}` → 3桁ゼロパディングの連番（例: 001）
- `{タイトル}` → ユーザー指定のタイトル
- `{日付}` → 作成日（YYYY-MM-DD形式）

### ステータスの種類
- **進行中** - 作業中のDD
- **完了** - 全タスク完了、アーカイブ待ち

## 注意事項

- DDを更新した場合は、必ず「ログ」セクションに記録を追加する
- タスク完了時は `[x]` に変更し、ログにも記録する

# DD-Know-How

**LLMの楽観バイアスを制御し、設計判断を記録し続ける開発フレームワーク**

Claude Code のスキルとして動作する、DD（Design Document）ドリブンの開発管理システムです。

---

## 解決する問題

AIコーディングアシスタントには構造的な弱点があります。

| 問題 | 結果 |
|------|------|
| **楽観バイアス** | 「問題ありません」で見落としを素通りする |
| **コンテキスト忘却** | セッションをまたぐと設計判断の経緯が消える |
| **場当たり実装** | 全体像なしに目の前のコードだけ書く |
| **自己レビューの甘さ** | 自分が書いたコードを「正しい」前提で確認する |

DD-Know-How はこれらに対して、仕組みで対抗します。

## 核心: DA批判レビュー（Devil's Advocate）

最大の特徴は **DA批判レビュー** です。各実装フェーズの完了前に、LLMに対して批判的視点を強制します。

```
❌「確認したか？」 → 「はい、問題ありません」
⭕「どこが壊れるか？」 → 壊れる前提で探すしかない
```

### 4段階の批判手順

1. **壊れる前提で探す** — 「完了した」ではなく「何が壊れるか」と問う
2. **暗黙の前提を疑う** — 「今動いている」ではなく「前提が崩れるケースは？」
3. **将来の破壊を予測** — 「今は問題ない」ではなく「半年後の変更で壊れないか？」
4. **発見を記録** — 何も見つからないのは疑わしい。変更ファイルを読み直して再チェック

### 再チェックの自動発動

発見した問題の重要度に応じて、別角度からの再チェックが自動的に発動します。

- **条件A**: 重要度「中」以上が1件でもあれば → 視点を変えて再チェック必須
- **条件B**: 発見数が閾値を超えた場合 → まだ潜んでいる前提で再チェック

実際の運用では、Phase 2で重要度「中」の問題が見つかり、別角度の再チェックで同種の問題をもう1件発見する、というケースが繰り返し起きています。条件Aがなければ素通りしていた不具合です。

### 発見の実例

バグ修正DD（[実例](doc/examples/dd-bug-fix-with-review.md)）から抜粋:

```markdown
### Phase 2 DA批判レビュー

| # | 発見した問題 | 重要度 | DA観点 | 対応 |
|---|------------|--------|--------|------|
| 1 | 別ファイルにも同じ誤ったコードが含まれていた | 高 | 依存関係の見落とし | ✅ 修正済 |
| 2 | JSDoc型定義に新タイプが未追加だった | 中 | エッジケース漏れ | ✅ 追加済 |
```

「問題なし」ではなく、具体的な問題を探して記録する。これがDA批判レビューの本質です。

### DA品質フィルター（ノイズ削減）

DA批判レビューは「問題を探す」ことを強制するため、**誤検出（false positive）** が混入します。実運用で確認された典型的なノイズ:

- `{}` が falsy だと誤って指摘（JS では truthy）→ **事実誤認**
- Phase 5 対応予定の TODO を毎 Phase で再指摘 → **既知事項の冗長な再指摘**
- 「壊れるかもしれない」だけで再現手順がない → **検証不能な指摘**

これらを排除する4ルール:

| # | ルール | 内容 |
|---|--------|------|
| 1 | **検証義務** | 指摘前にコード実行 or 仕様確認で事実確認。推測だけの指摘は記録しない |
| 2 | **既知事項の除外** | `TODO`/`FIXME`、「Phase X で対応」、別DDスコープアウト済みは指摘対象外 |
| 3 | **深刻度の判定基準** | 高=今のPhaseで壊れる、中=特定条件下で壊れる、低=改善提案 |
| 4 | **再現手順の必須化** | 高/中には「何をすると→何が起きるか」を必ず記載 |

DA批判レビューの信号対雑音比（SNR）を高め、レビュー品質を維持します。詳細は [workflow/SKILL.md](.claude/skills/workflow/SKILL.md) を参照。

## DDとは何か

DDは「意思決定の記録」「タスク管理」「作業ログ」を1つのMarkdownファイルにまとめたものです。

```markdown
# DD-042: 認証方式の変更

## 目的        ← 何を、なぜやるのか
## 検討内容    ← どんな選択肢があったか
## 決定事項    ← 最終的に何を選んだか
## タスク一覧  ← Phase分割された作業リスト（各PhaseにDA批判レビュー付き）
## ログ        ← 時系列の作業記録
## DA批判レビュー記録  ← 各Phaseで「何が壊れるか」を探した記録
```

DDはセッションをまたいでも残り続けます。3ヶ月後に「なぜこの設計にしたのか」を振り返れる。これが、コンテキストが揮発するLLMとの開発で最も価値を持つ部分です。

## 開発フロー

### 9ステップ（Full）

重要な機能開発向け。仕様確認・実装前チェック・仕様書同期まで含む完全フロー。

```
Step 1: DD作成          「〇〇機能を作りたい」
Step 2: 仕様確認        ユーザー承認を得る
Step 3: 実装前チェック  仕様書・既存コードを確認
Step 4: コーディング    規約に従って実装
Step 5: テスト作成      必要に応じてテスト作成
Step 6: コード検証      Lint + セルフチェック
Step 7: レビュー        コードレビュー
Step 8: 仕様書同期      DDの変更を仕様書に反映 + コンテキスト回収
Step 9: コミット        git commit → DDアーカイブ
```

### 5ステップ（Standard）

日常的なタスク向けの簡易版: DD作成 → 実装 → テスト → レビュー → コミット

## スキル構成

DD-Know-How は役割ごとに分離されたスキルで構成されています。

| スキル | 役割 |
|--------|------|
| `/dd` | DD操作（作成・参照・一覧・アーカイブ）。軽量設計で、DD参照時にワークフロー全体がロードされない |
| `/workflow` | 9ステップフロー・Phase管理・DA批判レビュー・仕様書同期。開発作業時にオンデマンドでロード |
| `/setup` | 外部プロジェクトへのDD導入。対話的にレベル選択・パス設定を実施 |

## 導入方法

### 自分のプロジェクトに導入する

```bash
# dd-know-how リポジトリ内で Claude Code を起動
cd dd-know-how
claude

# 対象プロジェクトを指定してセットアップ
> /setup /path/to/your-project
```

2段階の導入レベルから選択:

| レベル | 内容 |
|--------|------|
| Level 1 | テンプレート + 基本ルール。まず試したい場合 |
| Level 2 | + `/dd` + `/workflow`（DA批判レビュー含む）。通常はこれで十分 |

手動セットアップの詳細は [IMPORT.md](IMPORT.md) を参照。

### DD-Know-How 自体を使う

```bash
git clone https://github.com/ishimori/dd-know-how.git
cd dd-know-how
claude
> /dd new ログイン機能の実装
```

## フォルダ構成

```
dd-know-how/
├── .claude/skills/          # スキル定義（skills形式）
│   ├── dd/SKILL.md          # DD操作（軽量版）
│   ├── workflow/SKILL.md    # 開発フロー・DA批判レビュー
│   └── setup/SKILL.md       # 外部プロジェクトへの導入
├── rules/                   # DD基本ルール
├── skills/                  # 言語別パターン集
│   ├── typescript/          # バックエンド・フロントエンド
│   └── python/              # Streamlit
├── templates/
│   └── dd_template.md       # DDテンプレート（DA批判レビュー組み込み済み）
├── doc/
│   ├── development-flow-full.md  # 9ステップフロー詳細
│   ├── examples/                 # 実例集（機能実装・設計判断・バグ修正）
│   ├── customization/            # カスタマイズガイド
│   └── UPGRADE-NOTICE.md        # 既存導入プロジェクト向けアップグレード手順
├── CLAUDE.md                # プロジェクト設定テンプレート
└── IMPORT.md                # 手動導入ガイド
```

## カスタマイズ

- [テンプレートのカスタマイズ](doc/customization/template-sections.md)
- [開発フローのバリエーション](doc/customization/development-flow-variants.md)
- [他のAI環境での使用](doc/customization/other-environments.md)
- [実例集](doc/examples/README.md) — 機能実装・設計判断・バグ修正の実例

## 設計思想

### なぜ「見落としチェック」ではなくDevil's Advocateか

初期バージョンでは「何を見落としているか？」と問う形式でした。しかし実運用で判明したのは、LLMは「見落とし」を問われると「特にありません」と答えがちだということです。

「どこが壊れるか？」と問い方を変えるだけで、LLMは壊れるポイントを探すモードに切り替わります。さらに6項目のDA観点チェックリストと最低発見数ルールで、形式的な「問題なし」を許さない構造にしています。

### なぜDDスキルを分割したか

DDスキルは当初428行の単一ファイルでした。DD参照したいだけでワークフロー全体がロードされ、コンテキストを圧迫していました。

DD操作（~120行）とワークフロー管理（~270行）に分離することで、必要な時に必要な分だけロードされる設計になりました。DA批判レビューの強制力はDDテンプレートのタスク項目が担うため、分離しても品質は維持されます。

## 複数人での運用

識別子プレフィックスで番号衝突を防ぎます。

```
DDI-001, DDI-002   # 石森の番号系列
DDSA-001, DDSA-002 # 斉藤の番号系列
```

## ライセンス

MIT License
